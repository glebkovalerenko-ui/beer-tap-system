# Phase 2.5 — Demo Stability Strategy

## Goal

Избежать “red screen moment” во время демо и обеспечить управляемое поведение при частичных сбоях backend/NFC.

---

## 1) Backend partial failure fallback

## Strategy
- Critical flows should degrade gracefully, not crash route.
- Prefer inline error blocks + actionable CTA over blocking alerts.
- Keep current context visible (guest, amount draft, shift state).

## Rules
1. If request fails: show clear message + `Повторить` + one fallback action.
2. If response timeout: mark state as `Unknown result`, propose `Проверить историю`.
3. Preserve local form input to avoid retyping.
4. Never clear selected guest context on network error.

## Per-flow fallback examples
- Top-up fail → “Не удалось подтвердить пополнение” + `Проверить историю`.
- Guest create fail → keep form data + `Повторить`.
- Shift close fail → keep summary and offer retry; don’t mark closed optimistically unless explicit demo mode.

---

## 2) Mock / Demo mode toggle strategy

## Toggle model
- Env flag: `VITE_DEMO_MODE=true` (read-only config style).
- Optional runtime toggle only for admin/debug role.

## Behavior in demo mode
- Use deterministic mock data when API/device unavailable.
- Keep same UI states and interaction logic as real mode.
- Visually indicate demo mode (non-intrusive badge).

## Guardrails
- Demo mode must not change API contracts.
- Demo mode should wrap data source, not duplicate screens.
- Clearly separate real vs mocked events in logs/debug labels.

---

## 3) NFC failure during demo

## Immediate behavior
- Show top-bar/system warning: `NFC недоступен`.
- Disable only NFC-dependent actions (issue/reissue scan steps).
- Keep guest lookup and top-up (if not card-gated) available.

## Recovery path
1. `Повторить подключение NFC`.
2. `Переключиться в demo card simulation` (if demo mode enabled).
3. Continue scenario with prebound guest card context.

## Presenter-safe script alternative
- If NFC fails, pivot to existing guest with bound card and continue top-up/history/shift story.

---

## 4) Preventing red-screen moments

## UI safety rules
- Route-level error boundaries/fallback containers for async UI blocks.
- Replace unhandled promise traces with user-facing toasts and stable screen state.
- No raw stack traces in visible production/demo UI.

## Operational safety rules
- Pre-demo health checklist:
  - API reachable
  - login works
  - NFC status known
  - demo data prepared
- “Safe reset” action in UI for returning to known state.

## Content safety
- Error copy in business language.
- Always provide next best action.
- Avoid dead-end states with no CTA.

---

## 5) Demo runbook (quick)

1. Start in known state (demo user logged in, shift closed).
2. Open shift.
3. Identify or create guest.
4. Perform top-up.
5. Show balance/history.
6. Trigger one controlled failure scenario (optional) and recover.
7. Close shift with quick report.

If any dependency fails:
- Keep shell visible,
- switch to fallback branch,
- continue with remaining stable flows.

---

## 6) Stability acceptance criteria

- No uncaught UI crash during standard demo script.
- All critical failures render actionable fallback state.
- NFC failure does not block entire demo narrative.
- Demo mode can run end-to-end without backend/NFC dependence (if enabled).
- Presenter can recover to known state in <= 30 seconds.
