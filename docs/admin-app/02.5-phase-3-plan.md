# Phase 2.5 — Phase 3 Incremental Execution Plan

## Execution rules

- Every milestone must be shippable.
- Build must remain working after each milestone.
- No backend contract changes.
- No Tauri bridge breaking changes.
- Reversible by commit-level rollback.

---

## Milestone 1 — Shell & Structure

## Scope
- Introduce POS-oriented app shell (top status bar + workspace regions).
- Preserve existing routes and feature availability.

## Files to modify
- `admin-app/src/App.svelte`
- `admin-app/src/styles/tokens.css`
- optional: add `admin-app/src/components/shell/*`

## New components
- `ShellTopBar.svelte`
- `ShellStatusPills.svelte`
- `ShellGuestContextChip.svelte`

## Acceptance criteria
- App loads and route navigation works.
- Login gate behavior unchanged.
- Shift/NFC/network placeholders visible in top shell.

## Regression risks
- Auth branch rendering break.
- Sidebar links/navigation regressions.

## Testing checklist
- `npm run build`
- Manual route traversal (`#/`, `#/guests`, `#/taps-kegs`)
- Login/logout smoke check

---

## Milestone 2 — Guest Context Refactor

## Scope
- Convert guest area to operation-first context panel.
- Keep create/edit/bind actions functional.

## Files to modify
- `admin-app/src/routes/Guests.svelte`
- `admin-app/src/components/guests/GuestList.svelte`
- `admin-app/src/components/guests/GuestDetail.svelte`
- optional new: `GuestContextPanel.svelte`

## New components
- `GuestContextHeader.svelte`
- `GuestPrimaryActions.svelte`

## Acceptance criteria
- Guest selection is fast and explicit.
- One primary CTA is visible in guest context.
- Existing create/edit/bind flows still work.

## Regression risks
- Event propagation break from list/detail to route.
- Selected guest state resets unexpectedly.

## Testing checklist
- Search/select guest
- Create guest
- Edit guest
- Bind card modal open/close and success path

---

## Milestone 3 — Top Up Flow Upgrade

## Scope
- Replace basic amount input with presets + keypad UX.
- Add robust loading/error/success states.

## Files to modify
- `admin-app/src/components/modals/TopUpModal.svelte` (or new panel)
- `admin-app/src/routes/Guests.svelte`
- `admin-app/src/stores/guestStore.js` (only UI-state-safe adjustments)

## New components
- `AmountKeypad.svelte`
- `AmountPresetChips.svelte`

## Acceptance criteria
- Top-up flow completed in <= 5 interactions from context.
- Button lock prevents double submit.
- Success feedback and fallback action present.

## Regression risks
- Amount parsing/format bugs.
- Loading state deadlocks on errors.

## Testing checklist
- Valid top-up
- Invalid amount validation
- API error handling path
- Repeated click prevention

---

## Milestone 4 — Balance & History Consolidation

## Scope
- Unified block for current balance + recent history + next actions.
- Graceful fallback if history data unavailable.

## Files to modify
- `admin-app/src/components/guests/GuestDetail.svelte`
- `admin-app/src/components/pours/PourFeed.svelte` (if reused)
- optional new: `GuestHistoryList.svelte`

## New components
- `BalanceCard.svelte`
- `RecentActivityList.svelte`

## Acceptance criteria
- Balance and recent events visible on one screen block.
- Empty and error states provide actionable CTA.

## Regression risks
- Data mapping mismatch between pours/transactions.
- UI clutter reducing clarity.

## Testing checklist
- Guest with history
- Guest without history
- Simulated load error messaging

---

## Milestone 5 — Shift Workflow

## Scope
- Add minimal open/close shift UX and quick summary.
- Use demo-safe fallback if backend endpoints are incomplete.

## Files to modify
- `admin-app/src/routes/Dashboard.svelte`
- `admin-app/src/stores/systemStore.js` (non-breaking additions only)
- optional new: `ShiftPanel.svelte`, `ShiftCloseReport.svelte`

## New components
- `ShiftStatusCard.svelte`
- `ShiftCloseModal.svelte`

## Acceptance criteria
- Shift state clearly visible in shell.
- Open/close actions available and understandable.
- Quick report displayed on close.

## Regression risks
- Coupling with emergency-stop logic.
- False-positive shift state due to stubs.

## Testing checklist
- Open shift flow
- Close shift flow
- No-open-shift guard behavior

---

## Milestone 6 — Polish & Demo Mode

## Scope
- Visual consistency pass (spacing, typography, component states).
- Demo mode toggle and safe fallbacks for unstable backend/NFC.

## Files to modify
- `admin-app/src/lib/config.js`
- `admin-app/src/App.svelte`
- `admin-app/src/stores/*` (targeted non-breaking feature flags)
- optional new: `demoModeStore.js`, `demoData.ts/js`

## New components
- `SystemFallbackBanner.svelte`
- `DemoModeToggle.svelte` (role/debug gated)

## Acceptance criteria
- Core demo script runs end-to-end even with partial failures.
- UI shows consistent hierarchy and spacing.
- No blocking technical error popups during demo.

## Regression risks
- Feature flag leakage into normal mode.
- Divergence between demo and real runtime paths.

## Testing checklist
- Normal mode smoke
- Demo mode smoke
- Simulated NFC/backend failure fallback
- Build and route sanity

---

## Delivery strategy

- One milestone = one PR-sized increment.
- Merge only with passing build and manual smoke checklist.
- Keep each milestone independently revertible.
