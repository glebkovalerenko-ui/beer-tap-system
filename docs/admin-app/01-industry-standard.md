# Industry-grade POS Admin App Standard (Phase 1)

## Context & goals

## Product context

`admin-app` — это рабочее место кассира/администратора точки self-service бара с NFC-картами гостей, балансами, пополнением и операциями по смене. Цель интерфейса — не “красивый CRUD”, а **быстрая и безопасная обработка повторяющихся денежных операций** в условиях шума, очереди и ограниченного внимания.

## Business goals

- Сократить время выполнения частых операций (выдать карту, пополнить, проверить баланс) до 15–45 секунд.
- Минимизировать финансовые ошибки и их стоимость (ошибочная сумма, неверный гость, неверная карта).
- Поддержать предсказуемую работу в degraded условиях (нестабильная сеть/NFC/бэкенд).
- Обеспечить трассируемость и доверие: каждый критичный шаг должен быть понятен, проверяем и восстановим.

## UX north star

**“Кассир выполняет любую частую операцию за 1–2 экрана, с одной главной кнопкой действия, а система всегда подсказывает следующий безопасный шаг.”**

---

## User roles & environment

## Primary roles

### 1) Кассир смены (primary)

- Фокус: скорость и корректность стандартных операций.
- Частые действия: поиск/идентификация гостя, выдача/привязка карты, пополнение, просмотр баланса.
- Ограничения: стресс, очередь, плохая связь, частая сменяемость персонала.

### 2) Администратор смены (secondary)

- Фокус: контроль рисков, инциденты, открытие/закрытие смены.
- Редкие, но критичные действия: блокировка/перевыпуск карты, корректировка по инциденту, отчет по смене.

## Operating environment

- Touch-first или гибрид touch + мышь.
- Стоячая работа, быстрые микросессии, много повторений.
- Важны крупные цели, минимум когнитивных переключений и “длинных форм”.

---

## Information architecture (operations-first)

> IA для POS строится **по операциям**, а не по сущностям БД.

Рекомендуемые top-level операции (5–7):

1. **Найти/идентифицировать гостя** (по карте, номеру, имени)
2. **Выдать карту / зарегистрировать гостя**
3. **Пополнить баланс**
4. **Проверить баланс и историю операций**
5. **Блокировать / перевыпустить карту и перенести баланс**
6. **Открыть / закрыть смену и увидеть быстрый отчет**
7. **Инциденты и восстановление** (отмена, дубликат, связь/NFC проблема)

Принцип: у каждой операции есть “домашний экран” с четким контекстом гостя/смены и 1 главным CTA.

---

## Core flows (happy path + edge cases)

## 1) Выдать карту / зарегистрировать гостя

### Happy path

1. Кассир нажимает “Выдать карту”.
2. Выбирает: “Новый гость” или “Существующий гость”.
3. Для нового: минимальные обязательные поля (например, имя + телефон).
4. Поднести карту к ридеру.
5. Система показывает подтверждение привязки + следующий шаг “Пополнить”.

### Edge cases

- Карта уже привязана к другому гостю.
- NFC reader недоступен.
- Дубликат гостя по телефону.

### Recovery

- Ясное сообщение + 1–2 безопасных варианта:
  - “Открыть профиль текущего владельца карты”,
  - “Попробовать снова”,
  - “Создать инцидент”.

## 2) Пополнить баланс

### Happy path

1. Кассир открывает контекст гостя (через карту/поиск).
2. Выбирает быстрый preset суммы или вводит через keypad.
3. Видит pre-check: гость, карта, сумма, метод оплаты.
4. Подтверждает операцию.
5. Получает success-toast + обновленный баланс + запись в истории.

### Edge cases

- Ошибочный ввод суммы (слишком большая, 0, невалидный формат).
- Транзакция timeout.
- Дублирующий submit (двойной тап).

### Recovery

- Валидация до submit.
- Блокировка кнопки в момент выполнения.
- Undo window (если поддерживается) или guided incident action.

## 3) Проверить баланс + история

### Happy path

1. Идентификация гостя.
2. На одном экране: текущий баланс + последние операции.
3. Быстрые действия рядом: “Пополнить”, “Блокировать карту”, “Инцидент”.

### Edge cases

- У гостя нет карт.
- История недоступна (временная ошибка API).

### Recovery

- Показать “данные недоступны” + “Обновить” + “Продолжить без истории” (если это безопасно).

## 4) Блокировка / перевыпуск / перенос баланса

### Happy path

1. Открыть карточку гостя/карты.
2. Выбрать high-risk действие.
3. Подтвердить (explicit confirm с причиной).
4. При перевыпуске: привязать новую карту + (опционально) перенос баланса.
5. Запись в audit trail + видимый статус старой/новой карты.

### Edge cases

- Новая карта уже занята.
- Невозможно завершить перенос баланса.

### Recovery

- Не доводить до “полу-состояний” без объяснения.
- Если операция частично выполнена — дать “следующий обязательный шаг” и чек-лист завершения.

## 5) Отмена последней операции / инцидент

### Happy path

1. После финансового действия показать undo-состояние на ограниченное время **или** “Открыть инцидент”.
2. Зафиксировать оператора, время, причину.
3. Подтвердить финальный статус операции.

### Edge cases

- Undo недоступен (уже прошло время/бекенд не поддерживает).

### Recovery

- Ясно указать “что можно сделать сейчас”: “Создать инцидент”, “Позвать администратора”, “Открыть журнал”.

## 6) Смена: открыть/закрыть + быстрый отчет

### Happy path

1. Открыть смену (пользователь, касса/точка, стартовое состояние).
2. Работать в рамках активной смены (статус всегда видим в shell).
3. Закрыть смену: итоговые суммы, операции, инциденты.
4. Подтвердить закрытие и показать краткий отчет.

### Edge cases

- Попытка операции без открытой смены.
- Невозможно закрыть из-за незавершенных инцидентов.

### Recovery

- Guardrails: объяснить блокировку и конкретный путь разблокировки.

---

## UI standards (touch targets, spacing, typography)

## Speed-first principles

- 1 главный CTA на экран.
- Частые операции должны быть завершены за 3–5 взаимодействий.
- Минимум модалок; modal только для high-risk/irreversible действий.

## Touch-first ergonomics

- Минимальный target для критичных кнопок: **44x44 px**, рекомендовано 48–56 px.
- Gap между интерактивными целями: 8–12 px минимум.
- Цифровой ввод суммы — keypad + пресеты, не только текстовое поле.

## Visual hierarchy

- В каждом экране:
  - Контекст (кто/какая карта/какая смена) в верхней зоне.
  - Primary action — визуально доминирует.
  - Secondary действия сгруппированы отдельно.
- Контраст текста и статусов: WCAG AA как минимум.

## Button states

- Явные состояния: default / hover / pressed / loading / disabled / success-feedback.
- Во время submit: disable repeat tap + loader + текст “Выполняем…”.

## Empty states

- Не “пусто”, а “что делать дальше”: CTA + подсказка.
- Примеры:
  - “Нет привязанных карт — привяжите карту”,
  - “История недоступна — обновить / продолжить”.

---

## Error handling & offline/degraded mode

## Error message standard

Каждая ошибка должна содержать:

1. Что случилось (человеческим языком).
2. Что это означает для пользователя сейчас.
3. Следующий лучший шаг.

Формула: **“Не удалось X. Y сейчас недоступно. Попробуйте Z / сделайте W.”**

## Degraded mode expectations

- Видимые глобальные статусы в shell:
  - сеть (online/offline/degraded),
  - NFC reader,
  - очередь неотправленных операций (если есть),
  - активная смена.
- При потере связи:
  - запрет/ограничение high-risk операций,
  - сохранение возможности безопасных read-only сценариев,
  - понятный recovery path после восстановления.

## Confirm vs Undo

- **Confirm** — для необратимых и рискованных действий (блокировка, перевыпуск, закрытие смены).
- **Undo** — для быстрых исправимых ошибок (неверная сумма/не тот гость), с коротким таймером и явной индикацией.

---

## Security & audit trail basics (что показывать кассиру)

## Minimal operator-visible security model

- Всегда видно, **кто** работает (оператор/роль).
- Всегда видно, **какая смена** активна.
- Для критичных действий сохраняются и отображаются:
  - timestamp,
  - оператор,
  - объект операции (guest/card/amount),
  - результат (успех/ошибка/отмена),
  - причина (для блокировок и инцидентов).

## Audit UX principles

- Журнал пригоден для разбора инцидента в течение 1–2 минут.
- Фильтры минимум: “денежные”, “ошибки”, “по гостю”, “по оператору”.
- Технические ID допустимы, но вторичны относительно business-readable записи.

---

## Do / Don’t

## Do

- Проектировать по операциям, а не по таблицам БД.
- Держать ключевой контекст гостя/смены всегда на экране.
- Применять guardrails против двойных списаний и неверного адресата.
- Давать next best action в любой ошибке/пустом состоянии.
- Фиксировать финансовые/критичные действия в журнале.

## Don’t

- Не прятать критичные статусы (смена/сеть/NFC) в глубине экранов.
- Не размазывать один flow по 3–4 экранам без причины.
- Не перегружать модалками каждое действие.
- Не использовать технические сообщения об ошибках как финальный UX.
- Не допускать неоднозначных CTA (“Сохранить” без контекста операции).

---

## Demo сценарий (script)

## Цель демо

За 6–8 минут показать зрелый POS-поток без ручных объяснений “что имелось в виду”.

## Suggested sequence

1. **Открытие смены**
   - Показать статус смены в shell.
2. **Выдача карты новому гостю**
   - Создать гостя → привязать карту через NFC → подтверждение.
3. **Пополнение баланса**
   - Быстрый preset + подтверждение + success + запись в истории.
4. **Проверка баланса и истории**
   - На одном экране показать текущий баланс и последние операции.
5. **Инцидентный сценарий**
   - Смоделировать ошибку (например, недоступный NFC/API) и показать recovery path.
6. **Блокировка/перевыпуск (если релевантно)**
   - Продемонстрировать high-risk confirm + итоговый статус.
7. **Закрытие смены**
   - Показать краткий отчет и финальный статус.

## Demo quality bar

- Ни одной “технической” ошибки без понятного next step.
- На каждом шаге очевиден главный CTA.
- Критичные статусы видимы постоянно.

---

## Acceptance criteria (measurable)

## Operation speed

- Выдача карты новому гостю: ≤ 60 сек при штатной работе.
- Пополнение известного гостя: ≤ 20 сек.
- Проверка баланса + история: ≤ 10 сек.

## Interaction economy

- Частые операции: не более 1–2 экранов.
- Пополнение: не более 5 взаимодействий от открытия guest context до подтверждения.

## Error resilience

- 100% критичных ошибок содержат next best action.
- 0 silent-fail сценариев (любая ошибка/таймаут явно отражается в UI).
- Двойной submit финансовой операции предотвращен UI/logic guard.

## Operational visibility

- В shell всегда видны: shift status, network status, NFC status.
- Для финансовых действий доступна запись в журнале с оператором и timestamp.

## Consistency & accessibility

- Touch targets >= 44 px для primary actions.
- Контраст текста/статусов соответствует минимум WCAG AA.
- Единые компоненты/состояния применяются в core flows без визуального “зоопарка”.

---

## Optional demo enhancers (без перегруза)

1. **Status bar с unsynced queue**
   - Прозрачная индикация “сколько операций ожидает синхронизации”.
2. **Action journal panel**
   - Быстрый фильтр “последние 10 критичных действий”.
3. **Demo mode flag**
   - Гарантированная воспроизводимость демо при частично недоступном бэкенде/устройствах.

---

## Phase 1 exit checklist

- [x] Определен operations-first стандарт для POS admin-app.
- [x] Зафиксированы роли, среда и приоритеты частых/критичных задач.
- [x] Описаны core flows с edge cases и recovery.
- [x] Сформированы UI/UX стандарты (touch-first, states, errors, hierarchy).
- [x] Сформирован измеримый acceptance criteria набор для дальнейшей реализации.
