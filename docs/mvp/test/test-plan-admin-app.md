# Протокол приёмочного тестирования: Admin App (v1.0.0) - Версия 2.0 (Расширенная)

## Раздел 1: Введение и мета-информация

### 1.1. Цель документа
Настоящий документ является единым источником правды для проведения ручного приёмочного тестирования `Admin App`. **Версия 2.0** расширяет первоначальный план, добавляя негативные сценарии, проверки граничных значений, переходов состояний и целостности данных с целью выявления не только функциональных ошибок, но и потенциальных архитектурных уязвимостей.

### 1.2. Объекты тестирования
*   **Приложение:** `Admin App`
*   **Версия:** `1.0.0`
*   **Стек:** Tauri / Svelte / Rust
*   **Границы ответственности:** Документ покрывает тестирование всех ключевых модулей приложения.

### 1.3. Легенда и руководство по заполнению
| Поле | Описание |
| :--- | :--- |
| **Статус** | `[ ]` To Do (К выполнению), `[✅]` Pass (Пройден), `[❌]` Fail (Провален), `[⚠️]` Blocked (Заблокирован) |
| **Приоритет** | `P1` (Critical), `P2` (High), `P3` (Medium) |
| **Фактический результат**| Краткая и объективная констатация факта. Для статуса `Pass` можно оставить пустым или написать "Соответствует ОР". Для `Fail` — описать, что пошло не так. |
| **Примечания / Bug ID**| ID задачи из трекера (например, `issue-123`), ссылки на скриншоты, важные наблюдения или комментарии. |

### 1.4. Структура плана тестирования (Mind Map)
```mermaid
mindmap
  root((Протокол тестирования: Admin App v2))
    ::icon(fa fa-clipboard-check)
    (Модуль 1: Core & Navigation)
      ::icon(fa fa-compass)
      Позитивные сценарии (Вход/Выход)
        ::icon(fa fa-check-circle)
      Негативные сценарии (Неверный пароль, пустые поля)
        ::icon(fa fa-times-circle)
      Граничные значения (Длинные строки)
        ::icon(fa fa-arrows-alt-h)
      Безопасность (Прямой доступ к роутам)
        ::icon(fa fa-shield-alt)
    (Модуль 2: Data Stores & State Management)
      ::icon(fa fa-database)
      Успешная загрузка (Fetch)
        ::icon(fa fa-check-circle)
      Негативные сценарии (Ошибки API, нет токена)
        ::icon(fa fa-times-circle)
      Откат "оптимистичного" UI
        ::icon(fa fa-undo)
      Надежность (Остановка поллинга при ошибках)
        ::icon(fa fa-heartbeat)
    (Модуль 3: Feature UI: Dashboard)
      ::icon(fa fa-tachometer-alt)
      Позитивные сценарии (Отображение виджетов)
        ::icon(fa fa-check-circle)
      Переходы состояний (Emergency Stop)
        ::icon(fa fa-sync-alt)
      Негативные сценарии (Ошибка API при активации)
        ::icon(fa fa-times-circle)
    (Модуль 4: Feature UI: Guests)
      ::icon(fa fa-users)
      CRUD операции (Happy Path)
        ::icon(fa fa-check-circle)
      Негативные сценарии (Дубликаты, ошибки NFC)
        ::icon(fa fa-times-circle)
      Граничные значения (0, -1, длинные строки)
        ::icon(fa fa-arrows-alt-h)
      Откат UI (Ошибка пополнения баланса)
        ::icon(fa fa-undo)
    (Модуль 5: Feature UI: Taps & Kegs)
      ::icon(fa fa-beer)
      Ключевые бизнес-процессы (Назначение кеги)
        ::icon(fa fa-check-circle)
      Целостность данных (Удаление используемого напитка)
        ::icon(fa fa-link)
      Переходы состояний (Назначение на занятый кран)
        ::icon(fa fa-sync-alt)
      Откат UI (Ошибка назначения кеги)
        ::icon(fa fa-undo)
```
---

## Раздел 2: Протокол тестирования

### Модуль 1: Core & Navigation

| ID | Приоритет | Статус | Сценарий (Gherkin) | Фактический результат | Примечания / Bug ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-CORE-01 | P1 | `[ ]` | **Scenario:** Успешный запуск приложения<br>**Given** Приложение не запущено<br>**When** Пользователь запускает его<br>**Then** Открывается окно приложения и отображается компонент Login | | |
| TC-CORE-02 | P2 | `[ ]` | **Scenario:** Корректное закрытие приложения<br>**Given** Приложение запущено<br>**When** Пользователь нажимает системную кнопку "Закрыть"<br>**Then** Процесс приложения корректно завершается в ОС | | |
| TC-CORE-03 | P1 | `[ ]` | **Scenario:** Успешный вход в систему<br>**Given** Пользователь на экране входа с валидными данными<br>**When** Нажимает "Log In"<br>**Then** Токен сохраняется, происходит редирект на Dashboard | | |
| TC-CORE-04 | P2 | `[ ]` | **Scenario:** (Негативный) Попытка входа с неверным паролем<br>**Given** Пользователь на экране входа<br>**When** Вводит верный логин и неверный пароль<br>**Then** Под формой отображается ошибка, пользователь остается на странице | | |
| TC-CORE-05 | P1 | `[ ]` | **Scenario:** Успешный выход из системы<br>**Given** Пользователь аутентифицирован<br>**When** Нажимает "Log Out"<br>**Then** Токен удаляется из Local Storage, отображается экран входа | | |
| TC-CORE-06 | P1 | `[ ]` | **Scenario:** Восстановление сессии после перезапуска<br>**Given** Пользователь аутентифицирован и токен есть в Local Storage<br>**When** Перезапускает приложение<br>**Then** Сразу видит Dashboard без экрана входа | | |
| TC-CORE-07 | P1 | `[ ]` | **Scenario:** Навигация по приложению<br>**Given** Пользователь аутентифицирован<br>**When** Нажимает на ссылки "Guests" и "Taps & Kegs"<br>**Then** Отображаются корректные страницы | | |
| TC-CORE-08 | P2 | `[ ]` | **Scenario:** Отображение баннера "Emergency Stop"<br>**Given** 'systemStore.emergencyStop' = true<br>**When** UI перерисовывается<br>**Then** Вверху окна появляется глобальный баннер | | |
| TC-CORE-09 | P2 | `[ ]` | **Scenario:** (Негативный) Попытка входа с пустыми данными<br>**Given** Пользователь на экране входа<br>**When** Оставляет поля пустыми и пытается войти<br>**Then** Кнопка "Log In" неактивна или появляется ошибка валидации | | |
| TC-CORE-10 | P3 | `[ ]` | **Scenario:** (Граничный) Попытка входа с очень длинными строками<br>**Given** Пользователь на экране входа<br>**When** Вводит 256+ символов в поля и нажимает "Log In"<br>**Then** Приложение не падает, API корректно обрабатывает запрос | | |
| TC-CORE-11 | P1 | `[ ]` | **Scenario:** (Безопасность) Прямой переход на защищенный роут без аутентификации<br>**Given** Пользователь не аутентифицирован<br>**When** Пытается открыть URL `/#/guests`<br>**Then** Происходит автоматический редирект на страницу входа (`/#/login`) | | |

### Модуль 2: Data Stores & State Management

| ID | Приоритет | Статус | Сценарий (Gherkin) | Фактический результат | Примечания / Bug ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-STORE-01 | P1 | `[ ]` | **Scenario:** Успешная загрузка данных (Fetch)<br>**Given** Пользователь аутентифицирован<br>**When** Вызывается 'fetchGuests'<br>**Then** 'loading'->'true'->'false', 'guests' заполнен, 'error'->'null' | | |
| TC-STORE-02 | P1 | `[ ]` | **Scenario:** (Негативный) Попытка загрузки данных без токена<br>**Given** Пользователь не аутентифицирован<br>**When** Вызывается 'fetchGuests'<br>**Then** Tauri-команда НЕ вызывается | | |
| TC-STORE-03 | P2 | `[ ]` | **Scenario:** (Негативный) Обработка ошибки API при загрузке<br>**Given** API вернет ошибку<br>**When** Вызывается 'fetchGuests'<br>**Then** 'error' содержит текст ошибки, 'guests' становится `[]` | | |
| TC-STORE-04 | P1 | `[ ]` | **Scenario:** Успешное "оптимистичное" обновление при создании<br>**Given** Стор содержит N элементов<br>**When** 'createGuest' успешно завершается<br>**Then** В сторе N+1 элементов без повторного fetch | | |
| TC-STORE-05 | P2 | `[ ]` | **Scenario:** Поллинг запускается и останавливается с сессией<br>**Given** Пользователь не аутентифицирован<br>**When** Входит, а затем выходит из системы<br>**Then** 'pourStore' запускает/останавливает 'setInterval' | | |
| TC-STORE-06 | P2 | `[ ]` | **Scenario:** Стор реагирует на события (NFC)<br>**Given** 'nfcReaderStore' активен<br>**When** Rust генерирует событие 'card-status-changed'<br>**Then** Состояние 'nfcReaderStore' корректно обновляется | | |
| TC-STORE-07 | P1 | `[ ]` | **Scenario:** (Откат UI) Корректный откат UI при ошибке "оптимистичного" создания<br>**Given** Пользователь инициировал создание сущности, и она появилась в UI<br>**When** API бэкенда возвращает ошибку<br>**Then** Временно добавленная сущность удаляется из стора/UI<br>**And** Стор 'error' заполняется текстом ошибки | | |
| TC-STORE-08 | P2 | `[ ]` | **Scenario:** (Безопасность) Реакция стора на невалидный/истекший токен<br>**Given** Токен в Local Storage истек или невалиден<br>**When** Любой стор пытается выполнить запрос к API<br>**Then** API возвращает ошибку 401/403<br>**And** 'sessionStore' автоматически выполняет logout | | |
| TC-STORE-09 | P3 | `[ ]` | **Scenario:** (Надежность) Поллинг-стор прекращает запросы после серии ошибок<br>**Given** 'pourStore' активен<br>**When** API начинает возвращать ошибку на 'get_pours' 3 раза подряд<br>**Then** Поллинг останавливается ('clearInterval'), чтобы не спамить бэкенд | | |

### Модуль 3: Feature UI: Dashboard

| ID | Приоритет | Статус | Сценарий (Gherkin) | Фактический результат | Примечания / Bug ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-DASH-01 | P1 | `[ ]` | **Scenario:** Успешная загрузка и отображение всех виджетов<br>**Given** Пользователь на "Dashboard"<br>**When** Все API-запросы успешны<br>**Then** Отображаются 'NfcReaderStatus', 'TapGrid', 'PourFeed' | | |
| TC-DASH-02 | P2 | `[ ]` | **Scenario:** Отображение состояния загрузки<br>**Given** API отвечают с задержкой<br>**When** Пользователь на "Dashboard"<br>**Then** Отображаются тексты "Loading..." | | |
| TC-DASH-03 | P1 | `[ ]` | **Scenario:** Успешная активация "Emergency Stop"<br>**Given** Система в штатном режиме<br>**When** Пользователь активирует ЧС и подтверждает<br>**Then** Кнопка меняет текст/цвет | | |
| TC-DASH-04 | P1 | `[ ]` | **Scenario:** Успешная деактивация "Emergency Stop"<br>**Given** Система в режиме ЧС<br>**When** Пользователь деактивирует ЧС и подтверждает<br>**Then** Кнопка возвращается в исходное состояние | | |
| TC-DASH-05 | P2 | `[ ]` | **Scenario:** Отмена действия в модальном окне<br>**Given** Открыто модальное окно подтверждения ЧС<br>**When** Пользователь нажимает "Cancel"<br>**Then** Окно закрывается, состояние не меняется | | |
| TC-DASH-06 | P2 | `[ ]` | **Scenario:** (Негативный) Ошибка API при изменении статуса "Emergency Stop"<br>**Given** Пользователь пытается изменить статус ЧС<br>**When** API возвращает ошибку<br>**Then** Модальное окно закрывается, но кнопка не меняет состояние<br>**And** Появляется уведомление об ошибке | | |
| TC-DASH-07 | P3 | `[ ]` | **Scenario:** (Переход состояний) Обновление статуса ЧС, пока открыто модальное окно<br>**Given** У пользователя открыто модальное окно для активации ЧС<br>**When** Другой администратор активирует ЧС удаленно<br>**Then** Модальное окно закрывается, UI дашборда обновляется | | |

### Модуль 4: Feature UI: Guests

| ID | Приоритет | Статус | Сценарий (Gherkin) | Фактический результат | Примечания / Bug ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-GUEST-01 | P1 | `[ ]` | **Scenario:** Успешная загрузка и ручное обновление списка<br>**Given** Пользователь на странице "Guests"<br>**When** Нажимает "Refresh List"<br>**Then** Список обновляется | | |
| TC-GUEST-02 | P1 | `[ ]` | **Scenario:** Фильтрация списка через поиск<br>**Given** Есть "Иванов" и "Петров"<br>**When** Вводит "Иван"<br>**Then** Остается только "Иванов" | | |
| TC-GUEST-03 | P1 | `[ ]` | **Scenario:** Выбор гостя и отображение деталей<br>**Given** Отображается список<br>**When** Нажимает на гостя<br>**Then** Справа появляется панель 'GuestDetail' | | |
| TC-GUEST-04 | P1 | `[ ]` | **Scenario:** Успешное создание нового гостя<br>**Given** Пользователь на странице "Guests"<br>**When** Нажимает "+ New Guest", заполняет и сохраняет<br>**Then** Новый гость появляется в списке | | |
| TC-GUEST-05 | P1 | `[ ]` | **Scenario:** Успешное редактирование гостя<br>**Given** Открыта панель 'GuestDetail'<br>**When** Нажимает "Edit", изменяет и сохраняет<br>**Then** Данные в UI обновляются | | |
| TC-GUEST-06 | P2 | `[ ]` | **Scenario:** (Негативный) Ошибка API при сохранении гостя<br>**Given** Открыто модальное окно 'GuestForm'<br>**When** API возвращает ошибку при сохранении<br>**Then** Модальное окно НЕ закрывается, внутри отображается ошибка | | |
| TC-GUEST-07 | P1 | `[ ]` | **Scenario:** Успешная привязка RFID-карты<br>**Given** Открыта панель 'GuestDetail'<br>**When** Нажимает "+ Bind Card" и подносит карту<br>**Then** Новая карта появляется в списке у гостя | | |
| TC-GUEST-08 | P2 | `[ ]` | **Scenario:** (Негативный) Ошибка привязки (карта занята)<br>**Given** Карта уже занята<br>**When** API возвращает ошибку 409<br>**Then** 'NFCModal' показывает ошибку и не закрывается | | |
| TC-GUEST-09 | P1 | `[ ]` | **Scenario:** Успешное пополнение баланса<br>**Given** Открыта панель 'GuestDetail'<br>**When** Нажимает "+ Top Up", вводит сумму и сохраняет<br>**Then** Баланс в UI обновляется | | |
| TC-GUEST-10 | P3 | `[ ]` | **Scenario:** (Граничный) Создание гостя с очень длинным именем<br>**Given** Пользователь в модальном окне 'GuestForm'<br>**When** Вводит 256+ символов в поле имени и сохраняет<br>**Then** Система корректно обрабатывает (сохраняет или выдает ошибку валидации) | | |
| TC-GUEST-11 | P2 | `[ ]` | **Scenario:** (Целостность данных) Создание гостя с дублирующимися данными<br>**Given** В системе есть гость с документом "123456"<br>**When** Пользователь пытается создать нового гостя с тем же номером документа<br>**Then** API возвращает ошибку, которая отображается в модальном окне | | |
| TC-GUEST-12 | P2 | `[ ]` | **Scenario:** (Граничный) Пополнение баланса на 0, отрицательную сумму или нечисловое значение<br>**Given** Открыто модальное окно 'TopUpModal'<br>**When** Вводит "0", "-100" или "abc" и пытается сохранить<br>**Then** Кнопка сохранения неактивна или появляется ошибка валидации | | |
| TC-GUEST-13 | P2 | `[ ]` | **Scenario:** (Негативный) Ошибка NFC-считывателя во время ожидания карты<br>**Given** Открыто модальное окно 'NFCModal'<br>**When** Rust-бэкенд присылает событие об ошибке считывателя<br>**Then** Модальное окно отображает статус ошибки | | |
| TC-GUEST-14 | P1 | `[ ]` | **Scenario:** (Откат UI) Баланс гостя откатывается при ошибке пополнения<br>**Given** Пользователь инициировал пополнение, и баланс в UI оптимистично обновился<br>**When** API возвращает ошибку<br>**Then** Отображаемый баланс гостя в UI возвращается к исходному значению | | |

### Модуль 5: Feature UI: Taps & Kegs

| ID | Приоритет | Статус | Сценарий (Gherkin) | Фактический результат | Примечания / Bug ID |
| :--- | :--- | :--- | :--- | :--- | :--- |
| TC-TAPS-01 | P1 | `[ ]` | **Scenario:** Успешное добавление напитка<br>**Given** Пользователь на странице "Taps & Kegs"<br>**When** Добавляет напиток через 'BeverageManager'<br>**Then** Напиток появляется в списке | | |
| TC-TAPS-02 | P2 | `[ ]` | **Scenario:** (Негативный) Создание кеги при отсутствии напитков<br>**Given** Список напитков пуст<br>**When** Нажимает "+ Add New Keg"<br>**Then** Появляется 'alert', модальное окно не открывается | | |
| TC-TAPS-03 | P1 | `[ ]` | **Scenario:** Успешное создание кеги<br>**Given** Есть напитки<br>**When** Создает кегу через модальное окно<br>**Then** Новая кега появляется в 'KegList' | | |
| TC-TAPS-04 | P1 | `[ ]` | **Scenario:** Успешное назначение кеги на кран<br>**Given** Есть свободный кран и полная кега<br>**When** Назначает кегу на кран<br>**Then** Статусы крана и кеги в UI обновляются | | |
| TC-TAPS-05 | P2 | `[ ]` | **Scenario:** (Негативный) Попытка назначения кеги при отсутствии доступных<br>**Given** Нет полных кег<br>**When** Открывает модальное окно назначения<br>**Then** Отображается сообщение об отсутствии кег | | |
| TC-TAPS-06 | P1 | `[ ]` | **Scenario:** Успешное снятие кеги с крана<br>**Given** К крану привязана кега<br>**When** Снимает кегу с крана<br>**Then** Статусы крана и кеги в UI обновляются | | |
| TC-TAPS-07 | P2 | `[ ]` | **Scenario:** Управление состоянием крана (Lock/Activate/Cleaning)<br>**Given** Кран в одном из состояний<br>**When** Нажимает на кнопку управления<br>**Then** Статус крана в UI корректно меняется | | |
| TC-TAPS-08 | P1 | `[ ]` | **Scenario:** (Откат UI) Откат статусов при ошибке назначения кеги<br>**Given** UI оптимистично обновил статус крана и кеги<br>**When** API возвращает ошибку<br>**Then** Статусы крана и кеги в UI возвращаются к исходным | | |
| TC-TAPS-09 | P2 | `[ ]` | **Scenario:** (Целостность данных) Попытка удаления напитка, который используется в кеге<br>**Given** Напиток "Лагер" используется в кеге #5<br>**When** Пользователь пытается удалить "Лагер" из 'BeverageManager'<br>**Then** API возвращает ошибку, которая отображается в UI | | |
| TC-TAPS-10 | P2 | `[ ]` | **Scenario:** (Переход состояний) Попытка назначения кеги на занятый или неисправный кран<br>**Given** Кран #1 находится в статусе 'active' или 'cleaning'<br>**When** Пользователь нажимает "Assign Keg" (если кнопка активна)<br>**Then** Система не позволяет выполнить действие | | |
| TC-TAPS-11 | P2 | `[ ]` | **Scenario:** (Переход состояний) Попытка снятия кеги с заблокированного крана<br>**Given** Кран #1 со статусом 'locked', но на нем есть кега<br>**When** Пользователь нажимает "Unassign Keg"<br>**Then** Система позволяет снять кегу (или не позволяет, в зависимости от бизнес-логики) | | |
| TC-TAPS-12 | P2 | `[ ]` | **Scenario:** (Негативный) Ошибка API при изменении статуса крана<br>**Given** Пользователь пытается заблокировать кран<br>**When** API возвращает ошибку<br>**Then** Статус крана в UI не меняется, появляется уведомление | | |

---

## Раздел 3: Итоговая сводка (Summary)

### 3.1. Статистика выполнения

| Статус | Количество |
| :--- | :--- |
| ✅ Pass | |
| ❌ Fail | |
| ⚠️ Blocked | |
| **Всего** | **53** |

### 3.2. Ключевые выводы и рекомендации

*(Здесь тестировщик напишет краткое заключение о качестве объекта тестирования и рекомендации для команды разработки).*