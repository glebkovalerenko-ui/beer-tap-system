# –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: System Core & Services (v1.0.0)

## 1. –í–≤–µ–¥–µ–Ω–∏–µ –∏ –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### 1.1. –¶–µ–ª—å –¥–æ–∫—É–º–µ–Ω—Ç–∞
–ù–∞—Å—Ç–æ—è—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ `System Core & Services` –ø—Ä–æ–µ–∫—Ç–∞ **Beer Tap System**. –ï–≥–æ –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è **–Ω–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö** –∏ **—Å–∏—Å—Ç–µ–º–Ω—ã—Ö** –∞—Å–ø–µ–∫—Ç–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Å–∞. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–∞–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –Ω–µ—à—Ç–∞—Ç–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏.

### 1.2. –û–±—ä–µ–∫—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
–û–±—ä–µ–∫—Ç–æ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —è–≤–ª—è–µ—Ç—Å—è `System Core & Services` ‚Äî —è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã, –Ω–µ –∏–º–µ—é—â–µ–µ –ø—Ä—è–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –Ω–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–µ–µ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –≤—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞. –í –µ–≥–æ –≥—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –≤—Ö–æ–¥—è—Ç:
*   **–°–ª–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (PostgreSQL):** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –º–∏–≥—Ä–∞—Ü–∏–∏, —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.
*   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (Docker, .env):** –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤, –ø–µ—Ä–µ–¥–∞—á–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
*   **–ö–ª—é—á–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –∏ –ª–æ–≥–∏–∫–∞:** –ú–µ—Ö–∞–Ω–∏–∑–º—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞—É–¥–∏—Ç–∞.
*   **–û–±—â–µ—Å–∏—Å—Ç–µ–º–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:** –õ–æ–≥–∏–∫–∞, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—â–∞—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥—É–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, Emergency Stop).

### 1.3. –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è –∏ —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
–î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –¥–∞–Ω–Ω–æ–º—É –ø—Ä–æ—Ç–æ–∫–æ–ª—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–ª–µ–¥—É—é—â–µ–µ:
*   **–°—Ä–µ–¥–∞:** –õ–æ–∫–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∏ —Ä–∞–±–æ—Ç–∞—é—â–∏–º–∏ `Docker` –∏ `Docker Compose`.
*   **–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞ `Beer Tap System`.
*   **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
    *   –î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ (`bash`, `sh` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏).
    *   –ö–ª–∏–µ–Ω—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `psql`).
    *   –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.

### 1.4. –õ–µ–≥–µ–Ω–¥–∞ –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é
–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç-–∫–µ–π—Å –≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–º–µ—á–µ–Ω –æ–¥–Ω–∏–º –∏–∑ —Å—Ç–∞—Ç—É—Å–æ–≤.

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `[x]` | **Pass:** –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É. |
| `[!]` | **Fail:** –¢–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É. |
| `[-]` | **Blocked:** –¢–µ—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω –∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–µ–π –ø—Ä–æ–±–ª–µ–º—ã –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞. |
| `[ ]` | **To Do:** –¢–µ—Å—Ç –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è. |

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| **P1** | **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π:** –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑ –∫–æ—Ç–æ—Ä–æ–π —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å. |
| **P2** | **–í—ã—Å–æ–∫–∏–π:** –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–∞–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏. |
| **P3** | **–°—Ä–µ–¥–Ω–∏–π:** –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏. |

–û—Ç–ª–∏—á–Ω–∞—è –∏–¥–µ—è. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ–±–∑–æ—Ä–∞ –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏.

–ö–∞–∫ QA Lead, —è –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —Ö–æ—Ä–æ—à–∏–π –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–¥—Ä–æ–±–Ω—ã–º, –Ω–æ –∏ –Ω–∞–≥–ª—è–¥–Ω—ã–º. –Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª Mind Map (–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç-–∫–∞—Ä—Ç—É), –∫–æ—Ç–æ—Ä–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å—é –∏–µ—Ä–∞—Ä—Ö–∏—é —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –æ—Ç –º–æ–¥—É–ª–µ–π –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

–≠—Ç–∞ –∫–∞—Ä—Ç–∞ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ `README.md` –Ω–∞ GitHub –∏–ª–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ `mermaidchart.com`. –û–Ω–∞ –¥–∞–µ—Ç "–≤–∏–¥ —Å –≤—ã—Å–æ—Ç—ã –ø—Ç–∏—á—å–µ–≥–æ –ø–æ–ª–µ—Ç–∞" –Ω–∞ –≤—Å–µ –ø–æ–∫—Ä—ã—Ç–∏–µ, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏ —ç—Ç–æ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã (—á–µ—Ä–µ–∑ –∏—Ö ID).

---

### 1.5. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: `System Core & Services`**

–≠—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ –º–æ–¥—É–ª—è–º –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ–±–ª–∞—Å—Ç—è–º. –ö–∞–∂–¥—ã–π –∫–æ–Ω–µ—á–Ω—ã–π —É–∑–µ–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç-–∫–µ–π—Å –∏–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.

**–õ–µ–≥–µ–Ω–¥–∞ –∏–∫–æ–Ω–æ–∫:**
*   ‚úÖ **Happy Path:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
*   ‚ùå **Negative Path:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –æ—à–∏–±–∫—É –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
*   üîÑ **Idempotency/State:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏.
*   üõ°Ô∏è **Security/Rules:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–ª–∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

```mermaid
mindmap
  root((System Core & Services))
    (1. Database Layer)
      ::icon(fa fa-database)
      (DB Initialization)
        TC-SYS-DB-01: Happy Path ‚úÖ
        TC-SYS-DB-02: Negative - No Password ‚ùå
        TC-SYS-DB-03: Negative - Bad SQL Script ‚ùå
      (Data Persistence)
        TC-SYS-DB-04: Data survives restart üîÑ
      (Alembic Migrations)
        TC-SYS-DB-05: 'alembic upgrade head' ‚úÖ
        TC-SYS-DB-06: Idempotency check üîÑ
        TC-SYS-DB-07: 'alembic downgrade base' ‚úÖ
        TC-SYS-DB-08: Negative - DB Offline ‚ùå
        TC-SYS-DB-09: Negative - Auth Failure ‚ùå
      (App Connection)
        TC-SYS-DB-10: Backend fails with wrong password ‚ùå

    (2. Configuration & Environment)
      ::icon(fa fa-cogs)
      (.env File Management)
        TC-SYS-CFG-01: Happy Path - Correct .env ‚úÖ
        TC-SYS-CFG-02: Negative - No .env file ‚ùå
        TC-SYS-CFG-03: Negative - Missing required var ‚ùå
        TC-SYS-CFG-04: Negative - Invalid DATABASE_URL ‚ùå
      (Service Dependencies)
        TC-SYS-CFG-05: Backend waits for DB healthcheck üîÑ
        TC-SYS-CFG-06: Hardcoded secrets check üõ°Ô∏è

    (3. Core Services & Logic)
      ::icon(fa fa-atom)
      (Pour Sync Endpoint)
        TC-SYS-SRV-01: Idempotency - Duplicate TX üîÑ
        TC-SYS-SRV-02: Atomicity - Batch with one fail üîÑ
        TC-SYS-SRV-03: Resilience - DB fails on commit ‚ùå
      (Logging & Observability)
        TC-SYS-SRV-04: Logs startup/shutdown ‚úÖ
        TC-SYS-SRV-05: Logs 500 error with traceback ‚úÖ
      (Audit Service)
        TC-SYS-SRV-06: Audit on state-change POST ‚úÖ
        TC-SYS-SRV-07: No audit on read-only GET üõ°Ô∏è

    (4. System-Wide Business Rules)
      ::icon(fa fa-ruler-combined)
      (Emergency Stop Logic)
        TC-SYS-BIZ-01: Activation blocks pours üõ°Ô∏è
        TC-SYS-BIZ-02: Deactivation allows pours ‚úÖ
        TC-SYS-BIZ-03: RPi Controller respects flag üõ°Ô∏è
      (Inventory Lifecycle Rules)
        TC-SYS-BIZ-04: Cannot assign keg to occupied tap üõ°Ô∏è
        TC-SYS-BIZ-05: Cannot assign non-full keg üõ°Ô∏è
        TC-SYS-BIZ-06: Cannot delete 'in_use' keg üõ°Ô∏è
        TC-SYS-BIZ-07: Cannot pour from locked tap üõ°Ô∏è
```
---

## 2. –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ú–æ–¥—É–ª—å 1: Database Layer

| ID | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –°—Ü–µ–Ω–∞—Ä–∏–π (Gherkin) | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π / Bug ID |
| :--- | :--- | :--- | :--- | :--- |
| TC-SYS-DB-01 | P1 | `[ ]` | **Scenario:** –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î<br>**Given** –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `.env`<br>**And** –í `docker-compose.yml` —É–∫–∞–∑–∞–Ω volume `docs/postgres_schema.sql:/docker-entrypoint-initdb.d/init.sql`<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d --build`<br>**Then** –°–µ—Ä–≤–∏—Å "postgres" –¥–æ–ª–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∏ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "running"<br>**And** –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ "postgres" –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∞ "database system is ready to accept connections"<br>**And** –ö–æ–º–∞–Ω–¥–∞ `docker-compose exec postgres psql -U $POSTGRES_USER -d $POSTGRES_DB -c "\dt"` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü. | |
| TC-SYS-DB-02 | P1 | `[ ]` | **Scenario:** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ó–∞–ø—É—Å–∫ –±–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π POSTGRES_PASSWORD<br>**Given** –í —Ñ–∞–π–ª–µ `.env` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `POSTGRES_PASSWORD`<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d`<br>**Then** –°–µ—Ä–≤–∏—Å "postgres" –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å –∏–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è<br>**And** –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ "postgres" –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞ "password authentication failed". | |
| TC-SYS-DB-03 | P2 | `[ ]` | **Scenario:** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –û—à–∏–±–∫–∞ –≤ —Å–∫—Ä–∏–ø—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏<br>**Given** –§–∞–π–ª `docs/postgres_schema.sql` –∏–∑–º–µ–Ω–µ–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É SQL<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d --build`<br>**Then** –°–µ—Ä–≤–∏—Å "postgres" –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å –∏–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è<br>**And** –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ "postgres" –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `init.sql`. | |
| TC-SYS-DB-04 | P1 | `[ ]` | **Scenario:** –°–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (Data Persistence) –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞<br>**Given** –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ –≤ —Ç–∞–±–ª–∏—Ü—É `guests` –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose down` –∏ –∑–∞—Ç–µ–º `docker-compose up -d`<br>**Then** –°–µ—Ä–≤–∏—Å "postgres" –¥–æ–ª–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è<br>**And** –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —á–µ—Ä–µ–∑ psql —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `guests` –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å. | |
| TC-SYS-DB-05 | P1 | `[ ]` | **Scenario:** –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ü–µ—Ä–≤–∏—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (Alembic)<br>**Given** –°–µ—Ä–≤–∏—Å "postgres" –∑–∞–ø—É—â–µ–Ω —Å —á–∏—Å—Ç–æ–π —Å—Ö–µ–º–æ–π<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose exec beer_backend_api alembic upgrade head`<br>**Then** –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ<br>**And** –í –ë–î –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü–∞ `alembic_version` —Å –∑–∞–ø–∏—Å—å—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏. | |
| TC-SYS-DB-06 | P2 | `[ ]` | **Scenario:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–π (Alembic)<br>**Given** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose exec beer_backend_api alembic upgrade head`<br>**Then** –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ, –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π. | |
| TC-SYS-DB-07 | P2 | `[ ]` | **Scenario:** –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –û—Ç–∫–∞—Ç –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π (Alembic)<br>**Given** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose exec beer_backend_api alembic downgrade base`<br>**Then** –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ<br>**And** –í —Ç–∞–±–ª–∏—Ü–µ `alembic_version` –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–∏—Å–µ–π. | |
| TC-SYS-DB-08 | P1 | `[ ]` | **Scenario:** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ø—ã—Ç–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –ë–î<br>**Given** –°–µ—Ä–≤–∏—Å "postgres" –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose exec beer_backend_api alembic upgrade head`<br>**Then** –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (e.g., "Connection refused"). | |
| TC-SYS-DB-09 | P1 | `[ ]` | **Scenario:** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ü–æ–ø—ã—Ç–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏<br>**Given** –°–µ—Ä–≤–∏—Å "postgres" –∑–∞–ø—É—â–µ–Ω, –Ω–æ –≤ `.env` —É–∫–∞–∑–∞–Ω –Ω–µ–≤–µ—Ä–Ω—ã–π `POSTGRES_PASSWORD` –∏ —Å–µ—Ä–≤–∏—Å `beer_backend_api` –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose exec beer_backend_api alembic upgrade head`<br>**Then** –ö–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —Å –æ—à–∏–±–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. | |

### –ú–æ–¥—É–ª—å 2: Configuration & Environment

| ID | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –°—Ü–µ–Ω–∞—Ä–∏–π (Gherkin) | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π / Bug ID |
| :--- | :--- | :--- | :--- | :--- |
| TC-SYS-CFG-01 | P1 | `[ ]` | **Scenario:** –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ó–∞–ø—É—Å–∫ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º .env —Ñ–∞–π–ª–æ–º<br>**Given** –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª `.env` —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d`<br>**Then** –°–µ—Ä–≤–∏—Å—ã "postgres" –∏ "beer_backend_api" –¥–æ–ª–∂–Ω—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è<br>**And** API –ø–æ `http://localhost:8000/` –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 200 OK. | |
| TC-SYS-CFG-02 | P1 | `[ ]` | **Scenario:** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ó–∞–ø—É—Å–∫ –±–µ–∑ .env —Ñ–∞–π–ª–∞<br>**Given** –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª `.env`<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d`<br>**Then** `docker-compose` –¥–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –ø—É—Å—Ç—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö<br>**And** –°–µ—Ä–≤–∏—Å—ã "postgres" –∏ "beer_backend_api" –¥–æ–ª–∂–Ω—ã —É–ø–∞—Å—Ç—å –∏–ª–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è. | |
| TC-SYS-CFG-03 | P1 | `[ ]` | **Scenario:** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (POSTGRES_DB)<br>**Given** –í —Ñ–∞–π–ª–µ `.env` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `POSTGRES_DB`<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d`<br>**Then** –°–µ—Ä–≤–∏—Å "postgres" –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å —Å –æ—à–∏–±–∫–æ–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–º–µ–Ω–∏ –ë–î. | |
| TC-SYS-CFG-04 | P2 | `[ ]` | **Scenario:** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π: –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ DATABASE_URL<br>**Given** –í `.env` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DATABASE_URL` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ö–æ—Å—Ç<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d`<br>**Then** –°–µ—Ä–≤–∏—Å "postgres" –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è, –∞ "beer_backend_api" - —É–ø–∞—Å—Ç—å<br>**And** –í –ª–æ–≥–∞—Ö "beer_backend_api" –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–µ–≤–µ—Ä–Ω–æ–º—É —Ö–æ—Å—Ç—É. | |
| TC-SYS-CFG-05 | P1 | `[ ]` | **Scenario:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±—ç–∫–µ–Ω–¥–∞ –æ—Ç healthcheck –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö<br>**Given** –í `docker-compose.yml` —Å–µ—Ä–≤–∏—Å "beer_backend_api" –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `service_healthy` —Å–µ—Ä–≤–∏—Å–∞ "postgres"<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç `docker-compose up -d`<br>**Then** –ó–∞–ø—É—Å–∫ "beer_backend_api" –Ω–µ –Ω–∞—á–Ω–µ—Ç—Å—è, –ø–æ–∫–∞ "postgres" –Ω–µ —Å—Ç–∞–Ω–µ—Ç "healthy"<br>**And** –í –ª–æ–≥–∞—Ö "beer_backend_api" –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ. | |

### –ú–æ–¥—É–ª—å 3: Core Services & Logic

| ID | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –°—Ü–µ–Ω–∞—Ä–∏–π (Gherkin) | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π / Bug ID |
| :--- | :--- | :--- | :--- | :--- |
| TC-SYS-SRV-01 | P1 | `[ ]` | **Scenario:** –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –Ω–∞–ª–∏–≤–∞<br>**Given** –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –≤–∞–ª–∏–¥–Ω—ã–π `PourData` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º `client_tx_id`<br>**When** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/sync/pours/`<br>**Then** –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "accepted"<br>**And** –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–π –∂–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å<br>**Then** –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "accepted" –∏ –ø—Ä–∏—á–∏–Ω–æ–π "duplicate"<br>**And** –í —Ç–∞–±–ª–∏—Ü–µ `pours` —Å–æ–∑–¥–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å. | |
| TC-SYS-SRV-02 | P1 | `[ ]` | **Scenario:** –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞–∫–µ—Ç–∞ —Å –æ–¥–Ω–∏–º –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º –Ω–∞–ª–∏–≤–æ–º<br>**Given** –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –ø–∞–∫–µ—Ç –∏–∑ –¥–≤—É—Ö –Ω–∞–ª–∏–≤–æ–≤: –æ–¥–∏–Ω –≤–∞–ª–∏–¥–Ω—ã–π, –¥—Ä—É–≥–æ–π - —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–æ–º —Å—Ä–µ–¥—Å—Ç–≤ —É –≥–æ—Å—Ç—è<br>**When** –ü–∞–∫–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/api/sync/pours/`<br>**Then** –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK<br>**And** –í –æ—Ç–≤–µ—Ç–µ —Å—Ç–∞—Ç—É—Å –¥–ª—è –≤–∞–ª–∏–¥–Ω–æ–≥–æ –Ω–∞–ª–∏–≤–∞ - "accepted", –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ - "rejected"<br>**And** –í –ë–î —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è. | |
| TC-SYS-SRV-03 | P2 | `[ ]` | **Scenario:** –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –°–±–æ–π –ë–î –≤–æ –≤—Ä–µ–º—è –∫–æ–º–º–∏—Ç–∞ –ø–∞–∫–µ—Ç–∞<br>**Given** –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –≤–∞–ª–∏–¥–Ω—ã–π –ø–∞–∫–µ—Ç –Ω–∞–ª–∏–≤–æ–≤<br>**When** –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/api/sync/pours/` –∏ —Å–∏–º—É–ª–∏—Ä—É–µ—Ç—Å—è —Å–±–æ–π `db.commit()`<br>**Then** API –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É 500 Internal Server Error<br>**And** –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ "Failed to commit pours batch"<br>**And** –í —Ç–∞–±–ª–∏—Ü–µ `pours` –Ω–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–∏ –æ–¥–Ω–æ–π –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –∏–∑ –ø–∞–∫–µ—Ç–∞. | |
| TC-SYS-SRV-04 | P1 | `[ ]` | **Scenario:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∂—É—Ä–Ω–∞–ª–µ –∞—É–¥–∏—Ç–∞ –¥–ª—è state-changing –æ–ø–µ—Ä–∞—Ü–∏–∏<br>**Given** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç —É—Å–ø–µ—à–Ω—ã–π POST-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –≥–æ—Å—Ç—è<br>**Then** –ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ<br>**And** –°—Ä–∞–∑—É –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `audit_logs` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å `actor_id` –∏ `action`. | |
| TC-SYS-SRV-05 | P2 | `[ ]` | **Scenario:** –ó–∞–ø–∏—Å—å –≤ –∂—É—Ä–Ω–∞–ª–µ –∞—É–¥–∏—Ç–∞ –ù–ï —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–ª—è read-only –æ–ø–µ—Ä–∞—Ü–∏–∏<br>**Given** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç GET-–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≥–æ—Å—Ç–µ–π<br>**Then** –ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ<br>**And** –í —Ç–∞–±–ª–∏—Ü–µ `audit_logs` –Ω–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–ª—è—Ç—å—Å—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π. | |

### –ú–æ–¥—É–ª—å 4: System-Wide Business Rules

| ID | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å | –°—Ü–µ–Ω–∞—Ä–∏–π (Gherkin) | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π / Bug ID |
| :--- | :--- | :--- | :--- | :--- |
| TC-SYS-BIZ-01 | P1 | `[ ]` | **Scenario:** –ê–∫—Ç–∏–≤–∞—Ü–∏—è Emergency Stop –¥–æ–ª–∂–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –Ω–∞–ª–∏–≤—ã<br>**Given** –§–ª–∞–≥ "emergency_stop_enabled" = 'false'<br>**When** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ –≤ 'true' —á–µ—Ä–µ–∑ API `/api/system/emergency_stop`<br>**Then** –ü–æ—Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/sync/pours/` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω —Å–µ—Ä–≤–µ—Ä–æ–º<br>**And** –°—Ç–∞—Ç—É—Å –Ω–∞–ª–∏–≤–∞ –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "rejected". | |
| TC-SYS-BIZ-02 | P1 | `[ ]` | **Scenario:** –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è Emergency Stop –¥–æ–ª–∂–Ω–∞ —Ä–∞–∑—Ä–µ—à–∞—Ç—å –Ω–æ–≤—ã–µ –Ω–∞–ª–∏–≤—ã<br>**Given** –§–ª–∞–≥ "emergency_stop_enabled" = 'true'<br>**When** –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ –≤ 'false' —á–µ—Ä–µ–∑ API<br>**Then** –ü–æ—Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/sync/pours/` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω<br>**And** –°—Ç–∞—Ç—É—Å –Ω–∞–ª–∏–≤–∞ –≤ –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "accepted". | |
| TC-SYS-BIZ-03 | P2 | `[ ]` | **Scenario:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∫–µ–≥—É –Ω–∞ —É–∂–µ –∑–∞–Ω—è—Ç—ã–π –∫—Ä–∞–Ω<br>**Given** –ö—Ä–∞–Ω ‚Ññ1 —É–∂–µ –∏–º–µ–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –∫–µ–≥—É<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –¥—Ä—É–≥—É—é –∫–µ–≥—É –Ω–∞ –∫—Ä–∞–Ω ‚Ññ1 —á–µ—Ä–µ–∑ `PUT /api/taps/1/keg`<br>**Then** API –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É 409 Conflict<br>**And** –ù–∞–∑–Ω–∞—á–µ–Ω–Ω–∞—è –Ω–∞ –∫—Ä–∞–Ω –∫–µ–≥–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –∏–∑–º–µ–Ω–∏—Ç—å—Å—è. | |
| TC-SYS-BIZ-04 | P2 | `[ ]` | **Scenario:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–µ–ø–æ–ª–Ω—É—é –∫–µ–≥—É –Ω–∞ –∫—Ä–∞–Ω<br>**Given** –ö—Ä–∞–Ω ‚Ññ1 —Å–≤–æ–±–æ–¥–µ–Ω, –∞ –∫–µ–≥–∞ ‚Ññ2 –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å "in_use" –∏–ª–∏ "empty"<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∫–µ–≥—É ‚Ññ2 –Ω–∞ –∫—Ä–∞–Ω ‚Ññ1<br>**Then** API –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É 409 Conflict. | |
| TC-SYS-BIZ-05 | P1 | `[ ]` | **Scenario:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫–µ–≥—É, –∫–æ—Ç–æ—Ä–∞—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è<br>**Given** –ö–µ–≥–∞ ‚Ññ1 –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –Ω–∞ –∫—Ä–∞–Ω –∏ –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å "in_use"<br>**When** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è —É–¥–∞–ª–∏—Ç—å –∫–µ–≥—É —á–µ—Ä–µ–∑ `DELETE /api/kegs/<ID_–∫–µ–≥–∏_1>`<br>**Then** API –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É 409 Conflict<br>**And** –ó–∞–ø–∏—Å—å –æ –∫–µ–≥–µ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞—Ç—å—Å—è –≤ –ë–î. | |
| TC-SYS-BIZ-06 | P2 | `[ ]` | **Scenario:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–≤–µ—Ä—à–∏—Ç—å –Ω–∞–ª–∏–≤ –∏–∑ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫—Ä–∞–Ω–∞<br>**Given** –ö—Ä–∞–Ω ‚Ññ2 –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å "locked"<br>**When** –ù–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –Ω–∞–ª–∏–≤–∞ —Å –∫—Ä–∞–Ω–∞ ‚Ññ2<br>**Then** –°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "rejected" –∏ –ø—Ä–∏—á–∏–Ω–æ–π "Tap is not in 'active' state". | |

---

## 3. –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ (Summary)

### 3.1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
| –í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤ | –ü—Ä–æ–π–¥–µ–Ω–æ (Pass) | –ü—Ä–æ–≤–∞–ª–µ–Ω–æ (Fail) | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ (Blocked) | –ù–µ –≤—ã–ø–æ–ª–Ω—è–ª–æ—Å—å (To Do) |
| :--- | :--- | :--- | :--- | :--- |
| 27 | | | | |

### 3.2. –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã –∏ —Ä–∏—Å–∫–∏
*(–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)*

### 3.3. –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç
*(–ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)*

**–†–µ—à–µ–Ω–∏–µ:** `[ ]` –†–µ–ª–∏–∑-–∫–∞–Ω–¥–∏–¥–∞—Ç `v1.0.0` **–ì–û–¢–û–í** –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é.
**–†–µ—à–µ–Ω–∏–µ:** `[ ]` –†–µ–ª–∏–∑-–∫–∞–Ω–¥–∏–¥–∞—Ç `v1.0.0` **–ù–ï –ì–û–¢–û–í** –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –∏–∑-–∑–∞ –Ω–∞–ª–∏—á–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ñ–µ–∫—Ç–æ–≤.