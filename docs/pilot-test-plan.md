# **План приёмочного тестирования Beer Tap System MVP v1.0**

## 1. Введение

### 1.1. Цель документа
Этот документ определяет объём, подход и конкретные сценарии для проведения комплексного End-to-End тестирования системы **Beer Tap System**. Целью тестирования является выявление и документирование дефектов, проверка соответствия системы функциональным требованиям и подтверждение её готовности к пилотному запуску.

### 1.2. Объекты тестирования
*   **Admin App (Tauri/Svelte):** Пользовательский интерфейс и бизнес-логика на стороне клиента.
*   **Backend (FastAPI):** API, бизнес-логика и взаимодействие с базой данных.
*   **RPi Controller (Python):** Логика эмуляции налива и взаимодействия с API.
*   **Интеграция:** Взаимодействие всех компонентов системы между собой.

### 1.3. Критерии успеха
*   **Выполнение:** 100% тест-кейсов выполнены и имеют финальный статус (`Pass` / `Fail`).
*   **Качество:** Отсутствуют дефекты с приоритетом `Critical`. Все дефекты с приоритетом `High` проанализированы и взяты в работу.
*   **Стабильность:** Приложение Admin App и бэкенд работают стабильно в течение всей сессии тестирования без необработанных ошибок или падений.

## 2. Протокол тестирования

### **Модуль 1: Аутентификация, доступ и жизненный цикл приложения**

| ID | TC-AUTH-01 |
| :--- | :--- |
| **Название** | Успешный вход в систему |
| **Предусловия** | Приложение Admin App запущено, пользователь знает корректные учётные данные. |
| **Шаги выполнения** | 1. Открыть приложение. <br> 2. Ввести корректный `username`. <br> 3. Ввести корректный `password`. <br> 4. Нажать кнопку "Log In". |
| **Ожидаемый результат**| 1. Экран входа исчезает. <br> 2. Отображается основной интерфейс приложения (Дашборд). |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-AUTH-02 |
| :--- | :--- |
| **Название** | Неуспешный вход в систему (неверный пароль) |
| **Предусловия** | Приложение Admin App запущено. |
| **Шаги выполнения** | 1. Открыть приложение. <br> 2. Ввести корректный `username`. <br> 3. Ввести **некорректный** `password`. <br> 4. Нажать кнопку "Log In". |
| **Ожидаемый результат**| 1. Пользователь остаётся на экране входа. <br> 2. Появляется сообщение об ошибке (например, "Incorrect username or password"). |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-AUTH-03 |
| :--- | :--- |
| **Название** | Выход из системы (Logout) |
| **Предусловия** | Пользователь успешно вошёл в систему. |
| **Шаги выполнения** | 1. Нажать кнопку "Log Out" в боковой панели. |
| **Ожидаемый результат**| 1. Основной интерфейс приложения исчезает. <br> 2. Отображается экран входа "Login". |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-APP-01 |
| :--- | :--- |
| **Название** | Корректное управление жизненным циклом фоновых процессов |
| **Предусловия** | Приложение Admin App запущено, открыты инструменты разработчика (DevTools). |
| **Шаги выполнения** | 1. Выполнить шаги из **TC-AUTH-01** (успешный вход). <br> 2. Проверить вывод в консоли DevTools. <br> 3. Выполнить шаги из **TC-AUTH-03** (выход). <br> 4. Проверить вывод в консоли DevTools. |
| **Ожидаемый результат**| 1. После шага 2 в консоли присутствует лог `[App.svelte] Компонент смонтирован, запускаем фоновые процессы.` <br> 2. После шага 4 в консоли присутствует лог `[App.svelte] Компонент уничтожен, останавливаем фоновые процессы.` |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

### **Модуль 2: Управление гостями и финансовые операции**

| ID | TC-GUEST-01 |
| :--- | :--- |
| **Название** | Полный CRUD-цикл гостя |
| **Предусловия** | Пользователь залогинен, открыта страница "Guests". |
| **Шаги выполнения** | 1. Нажать "+ New Guest". Ввести `First Name: Иван`, `Last Name: Петров`. Нажать "Create". <br> 2. В поле поиска ввести "Иван Пет". <br> 3. Выбрать гостя "Иван Петров" из списка. <br> 4. Нажать "Edit". Изменить `Last Name` на "Сидоров". Нажать "Save Changes". |
| **Ожидаемый результат**| 1. После шага 1 в списке появляется гость "Иван Петров". <br> 2. После шага 2 в списке остаётся только гость "Иван Петров". <br> 3. После шага 4 в списке и в панели деталей имя гостя изменяется на "Иван Сидоров". |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-CARD-01 |
| :--- | :--- |
| **Название** | Привязка новой RFID-карты к гостю |
| **Предусловия** | Пользователь залогинен. Существует гость без привязанных карт. ACR122 подключен. Есть свободная RFID-карта. |
| **Шаги выполнения** | 1. Выбрать гостя без карт. <br> 2. В панели деталей нажать "+ Bind Card". <br> 3. В модальном окне NFC поднести карту к считывателю. |
| **Ожидаемый результат**| 1. Модальное окно сообщает об успехе и закрывается. <br> 2. В панели деталей у гостя появляется UID привязанной карты. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-CARD-02 |
| :--- | :--- |
| **Название** | Попытка привязки уже занятой RFID-карты |
| **Предусловия** | Карта с UID `ABCDEF12` уже привязана к "Гостю А". Пользователь залогинен. |
| **Шаги выполнения** | 1. Выбрать "Гостя Б". <br> 2. Нажать "+ Bind Card". <br> 3. Поднести карту с UID `ABCDEF12` к считывателю. |
| **Ожидаемый результат**| 1. Модальное окно NFC отображает ошибку (например, "Card is already assigned"). <br> 2. Карта НЕ привязывается к "Гостю Б". |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-FIN-01 |
| :--- | :--- |
| **Название** | Пополнение баланса гостя |
| **Предусловия** | Существует гость с балансом 0.00. |
| **Шаги выполнения** | 1. Выбрать гостя. <br> 2. Нажать "+ Top Up". <br> 3. Ввести сумму `1500`. <br> 4. Нажать "Save". |
| **Ожидаемый результат**| 1. Модальное окно закрывается. <br> 2. Баланс гостя в панели деталей мгновенно обновляется на `1500.00`. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

### **Модуль 3: Управление инвентарём и целостность данных**

| ID | TC-INV-01 |
| :--- | :--- |
| **Название** | Попытка удаления Напитка, используемого в Кеге |
| **Предусловия** | Существует Напиток "IPA". Существует Кега "IPA #1" с этим напитком. |
| **Шаги выполнения** | 1. Открыть страницу "Taps & Kegs". <br> 2. В менеджере напитков найти "IPA". <br> 3. Нажать на иконку удаления напротив "IPA". <br> 4. Подтвердить удаление. |
| **Ожидаемый результат**| 1. Появляется сообщение об ошибке (например, "Cannot delete beverage, it is used in one or more kegs"). <br> 2. Напиток "IPA" НЕ удаляется из списка. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-INV-02 |
| :--- | :--- |
| **Название** | Попытка удаления Кеги, назначенной на Кран |
| **Предусловия** | Кега "IPA #1" назначена на "Кран 1". |
| **Шаги выполнения** | 1. Открыть страницу "Taps & Kegs". <br> 2. В списке кег найти "IPA #1". <br> 3. Нажать на иконку удаления напротив "IPA #1". <br> 4. Подтвердить удаление. |
| **Ожидаемый результат**| 1. Появляется сообщение об ошибке (например, "Cannot delete keg, it is currently assigned to a tap"). <br> 2. Кега "IPA #1" НЕ удаляется из списка. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

### **Модуль 4: Операционная деятельность и сквозные сценарии**

| ID | TC-E2E-01 |
| :--- | :--- |
| **Название** | Сквозной сценарий: Имитация успешного налива |
| **Предусловия** | 1. Существует "Гость А" с балансом 2000.00. <br> 2. "Кран 1" активен, на нём Кега "IPA #1" с остатком 5000 мл. <br> 3. Стоимость 500 мл "IPA" составляет 350.00. |
| **Шаги выполнения** | 1. С помощью скрипта на RPi-контроллере сымитировать налив 500 мл "IPA" от имени "Гостя А". |
| **Ожидаемый результат**| 1. **(Дашборд)** В течение 15 секунд в "Ленте наливов" появляется новая запись: "Имя Гостя А, IPA, 500 мл". <br> 2. **(Страница Гостя)** Баланс "Гостя А" стал 1650.00. <br> 3. **(Страница Кранов)** Остаток в Кеге "IPA #1" на "Кране 1" стал 4500 мл. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-E2E-02 |
| :--- | :--- |
| **Название** | Граничный сценарий: Налив при недостаточном балансе |
| **Предусловия** | 1. "Гость Б" с балансом 100.00. <br> 2. Стоимость налива 350.00. |
| **Шаги выполнения** | 1. Сымитировать налив на RPi от имени "Гостя Б". |
| **Ожидаемый результат**| 1. Бэкенд-эндпоинт `/api/sync/pours/` возвращает для этой транзакции статус `failed` с причиной `insufficient_funds`. <br> 2. В "Ленте наливов" новая запись НЕ появляется. <br> 3. Баланс "Гостя Б" остаётся 100.00. <br> 4. Остаток в кеге не изменяется. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

### **Модуль 5: Безопасность и мониторинг**

| ID | TC-SEC-01 |
| :--- | :--- |
| **Название** | Полный цикл работы Emergency Stop |
| **Предусловия** | Пользователь залогинен, находится на Дашборде. |
| **Шаги выполнения** | 1. Нажать "Activate Emergency Stop", подтвердить действие. <br> 2. Сымитировать налив на RPi. <br> 3. Нажать "Deactivate Emergency Stop", подтвердить. <br> 4. Снова сымитировать налив на RPi. |
| **Ожидаемый результат**| 1. После шага 1 в Admin App появляется глобальный баннер о блокировке. <br> 2. Шаг 2 завершается неудачей, налив блокируется контроллером. <br> 3. После шага 3 баннер исчезает. <br> 4. Шаг 4 завершается успешно, налив проходит. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-SEC-02 |
| :--- | :--- |
| **Название** | Проверка корректности записей в Audit Log |
| **Предусловия** | Пользователь залогинен. Доступ к БД для проверки. |
| **Шаги выполнения** | 1. Создать нового гостя. <br> 2. Пополнить ему баланс. <br> 3. Назначить кегу на кран. <br> 4. Активировать Emergency Stop. |
| **Ожидаемый результат**| В таблице `audit_logs` в БД появились 4 новые записи, соответствующие каждому из выполненных действий, с корректным `actor_id` и `action`. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |

| ID | TC-MON-01 |
| :--- | :--- |
| **Название** | Отказоустойчивость UI при недоступности бэкенда |
| **Предусловия** | Admin App запущен и работает. |
| **Шаги выполнения** | 1. Остановить Docker-контейнеры бэкенда (`docker-compose stop backend postgres`). <br> 2. Переключиться между страницами в Admin App. <br> 3. Перезапустить контейнеры (`docker-compose start backend postgres`). |
| **Ожидаемый результат**| 1. После шага 1 приложение Admin App НЕ падает. <br> 2. На Дашборде и других страницах виджеты отображают сообщения об ошибке загрузки данных. <br> 3. После шага 3, в течение 15-20 секунд, виджеты автоматически восстанавливают работу и отображают актуальные данные. |
| **Факт. результат**| |
| **Статус** | |
| **Примечания** | |