
>>> Post http://localhost:8000/api/token
Form: password=fake_password&username=admin
<<< HTTP 200
{"access_token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw","token_type":"bearer"}

>>> Post http://localhost:8000/api/shifts/open
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
<<< HTTP 409

>>> Post http://localhost:8000/api/guests/
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
Body:
{
    "patronymic":  "Incident",
    "first_name":  "Balance",
    "date_of_birth":  "1990-01-15",
    "id_document":  "INCIDENT-94306",
    "phone_number":  "+199994306",
    "last_name":  "Zero"
}
<<< HTTP 201
{"last_name":"Zero","first_name":"Balance","patronymic":"Incident","phone_number":"+199994306","date_of_birth":"1990-01-15","id_document":"INCIDENT-94306","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","balance":"0.00","is_active":true,"created_at":"2026-02-28T12:34:15.647215Z","updated_at":"2026-02-28T12:34:15.647215Z","cards":[],"transactions":[],"pours":[]}

>>> Post http://localhost:8000/api/guests/2ab42e09-896b-47a3-a1cd-a549b5ac5def/cards
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
Body:
{
    "card_uid":  "INCIDENT-ZERO-BALANCE-CARD-94306"
}
<<< HTTP 200
{"last_name":"Zero","first_name":"Balance","patronymic":"Incident","phone_number":"+199994306","date_of_birth":"1990-01-15","id_document":"INCIDENT-94306","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","balance":"0.00","is_active":true,"created_at":"2026-02-28T12:34:15.647215Z","updated_at":"2026-02-28T12:34:15.647215Z","cards":[{"card_uid":"INCIDENT-ZERO-BALANCE-CARD-94306","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","status":"inactive","created_at":"2026-02-28T12:34:15.705762Z"}],"transactions":[],"pours":[]}

>>> Post http://localhost:8000/api/visits/open
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
Body:
{
    "guest_id":  "2ab42e09-896b-47a3-a1cd-a549b5ac5def",
    "card_uid":  "INCIDENT-ZERO-BALANCE-CARD-94306"
}
<<< HTTP 200
{"visit_id":"a330ef27-cba4-4134-a4d6-9c19cab24522","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","card_uid":"INCIDENT-ZERO-BALANCE-CARD-94306","status":"active","opened_at":"2026-02-28T12:34:15.754817Z","closed_at":null,"closed_reason":null,"active_tap_id":null,"lock_set_at":null,"card_returned":true}

>>> Post http://localhost:8000/api/beverages/
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
Body:
{
    "name":  "Incident Beer Zero Balance 94306",
    "sell_price_per_liter":  500
}
<<< HTTP 201
{"name":"Incident Beer Zero Balance 94306","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e"}

>>> Post http://localhost:8000/api/kegs/
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
Body:
{
    "beverage_id":  "fc7b76da-78ee-456c-85f1-ea7cae158d6e",
    "initial_volume_ml":  30000,
    "purchase_price":  1000
}
<<< HTTP 201
{"initial_volume_ml":30000,"purchase_price":"1000.00","keg_id":"58c1601f-13c8-4a48-b309-d8628bf3dbf5","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e","current_volume_ml":30000,"status":"full","tapped_at":null,"finished_at":null,"created_at":"2026-02-28T12:34:15.854805Z","beverage":{"name":"Incident Beer Zero Balance 94306","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e"}}

>>> Post http://localhost:8000/api/taps/
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
Body:
{
    "display_name":  "Incident Tap Zero Balance 94306"
}
<<< HTTP 201
{"display_name":"Incident Tap Zero Balance 94306","tap_id":2,"status":"locked","keg_id":null,"keg":null}

>>> Put http://localhost:8000/api/taps/2/keg
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
Body:
{
    "keg_id":  "58c1601f-13c8-4a48-b309-d8628bf3dbf5"
}
<<< HTTP 200
{"display_name":"Incident Tap Zero Balance 94306","tap_id":2,"status":"active","keg_id":"58c1601f-13c8-4a48-b309-d8628bf3dbf5","keg":{"initial_volume_ml":30000,"purchase_price":"1000.00","keg_id":"58c1601f-13c8-4a48-b309-d8628bf3dbf5","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e","current_volume_ml":30000,"status":"in_use","tapped_at":"2026-02-28T12:34:15.936239Z","finished_at":null,"created_at":"2026-02-28T12:34:15.854805Z","beverage":{"name":"Incident Beer Zero Balance 94306","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e"}}}

>>> Get http://localhost:8000/api/guests/2ab42e09-896b-47a3-a1cd-a549b5ac5def
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
<<< HTTP 200
{"last_name":"Zero","first_name":"Balance","patronymic":"Incident","phone_number":"+199994306","date_of_birth":"1990-01-15","id_document":"INCIDENT-94306","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","balance":"0.00","is_active":true,"created_at":"2026-02-28T12:34:15.647215Z","updated_at":"2026-02-28T12:34:15.647215Z","cards":[{"card_uid":"INCIDENT-ZERO-BALANCE-CARD-94306","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","status":"active","created_at":"2026-02-28T12:34:15.705762Z"}],"transactions":[],"pours":[]}

>>> Post http://localhost:8000/api/visits/authorize-pour
Headers: X-Internal-Token: replace-with-internal-service-token; X-Request-Id: incident-free-pour-auth-94306
Body:
{
    "card_uid":  "INCIDENT-ZERO-BALANCE-CARD-94306",
    "tap_id":  2
}
<<< HTTP 200
{"allowed":true,"visit":{"visit_id":"a330ef27-cba4-4134-a4d6-9c19cab24522","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","card_uid":"INCIDENT-ZERO-BALANCE-CARD-94306","status":"active","opened_at":"2026-02-28T12:34:15.754817Z","closed_at":null,"closed_reason":null,"active_tap_id":2,"lock_set_at":"2026-02-28T12:34:16.020990Z","card_returned":true},"reason":null}

>>> Get http://localhost:8000/api/pours/
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
<<< HTTP 200
[{"pour_id":"f840a0ad-bb25-4470-8e15-fb02ffb37741","volume_ml":0,"amount_charged":"0.00","duration_ms":null,"sync_status":"pending_sync","short_id":null,"is_manual_reconcile":false,"poured_at":"2026-02-28T12:34:16.020990Z","authorized_at":"2026-02-28T12:34:16.020990Z","synced_at":null,"reconciled_at":null,"ended_at":null,"started_at":null,"guest":{"guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","last_name":"Zero","first_name":"Balance"},"beverage":{"name":"Incident Beer Zero Balance 94306","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e"},"tap":{"display_name":"Incident Tap Zero Balance 94306","tap_id":2,"status":"processing_sync","keg_id":"58c1601f-13c8-4a48-b309-d8628bf3dbf5","keg":{"initial_volume_ml":30000,"purchase_price":"1000.00","keg_id":"58c1601f-13c8-4a48-b309-d8628bf3dbf5","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e","current_volume_ml":30000,"status":"in_use","tapped_at":"2026-02-28T12:34:15.936239Z","finished_at":null,"created_at":"2026-02-28T12:34:15.854805Z","beverage":{"name":"Incident Beer Zero Balance 94306","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e"}}}},{"pour_id":"7a8a9e98-d86a-4c63-8c2a-a0f68411002f","volume_ml":0,"amount_charged":"0.00","duration_ms":null,"sync_status":"pending_sync","short_id":null,"is_manual_reconcile":false,"poured_at":"2026-02-28T12:32:31.823421Z","authorized_at":"2026-02-28T12:32:31.823421Z","synced_at":null,"reconciled_at":null,"ended_at":null,"started_at":null,"guest":{"guest_id":"8bb41ecc-b4ae-46d4-b411-2f2e25e322c1","last_name":"Zero","first_name":"Balance"},"beverage":{"name":"Incident Beer Zero Balance","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"52c1ab5c-f85e-4ee7-9008-9cb2093b93b5"},"tap":{"display_name":"Incident Tap Zero Balance","tap_id":1,"status":"processing_sync","keg_id":"bc02770b-a20a-47b1-a826-f15c55dc24a1","keg":{"initial_volume_ml":30000,"purchase_price":"1000.00","keg_id":"bc02770b-a20a-47b1-a826-f15c55dc24a1","beverage_id":"52c1ab5c-f85e-4ee7-9008-9cb2093b93b5","current_volume_ml":30000,"status":"in_use","tapped_at":"2026-02-28T12:32:31.723768Z","finished_at":null,"created_at":"2026-02-28T12:32:31.618325Z","beverage":{"name":"Incident Beer Zero Balance","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"52c1ab5c-f85e-4ee7-9008-9cb2093b93b5"}}}}]

>>> Post http://localhost:8000/api/sync/pours
Headers: X-Internal-Token: replace-with-internal-service-token; X-Request-Id: incident-free-pour-sync-94306
Body:
{
    "pours":  [
                  {
                      "price_cents":  0,
                      "card_uid":  "INCIDENT-ZERO-BALANCE-CARD-94306",
                      "volume_ml":  200,
                      "tap_id":  2,
                      "client_tx_id":  "incident-zero-balance-sync-94306",
                      "short_id":  "ZB94306",
                      "duration_ms":  5000
                  }
              ]
}
<<< HTTP 200
{"results":[{"client_tx_id":"incident-zero-balance-sync-94306","status":"rejected","outcome":"rejected_insufficient_funds","reason":"Insufficient funds for Guest 2ab42e09-896b-47a3-a1cd-a549b5ac5def."}]}

>>> Get http://localhost:8000/api/pours/
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
<<< HTTP 200
[{"pour_id":"f840a0ad-bb25-4470-8e15-fb02ffb37741","volume_ml":0,"amount_charged":"0.00","duration_ms":null,"sync_status":"pending_sync","short_id":null,"is_manual_reconcile":false,"poured_at":"2026-02-28T12:34:16.020990Z","authorized_at":"2026-02-28T12:34:16.020990Z","synced_at":null,"reconciled_at":null,"ended_at":null,"started_at":null,"guest":{"guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","last_name":"Zero","first_name":"Balance"},"beverage":{"name":"Incident Beer Zero Balance 94306","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e"},"tap":{"display_name":"Incident Tap Zero Balance 94306","tap_id":2,"status":"processing_sync","keg_id":"58c1601f-13c8-4a48-b309-d8628bf3dbf5","keg":{"initial_volume_ml":30000,"purchase_price":"1000.00","keg_id":"58c1601f-13c8-4a48-b309-d8628bf3dbf5","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e","current_volume_ml":30000,"status":"in_use","tapped_at":"2026-02-28T12:34:15.936239Z","finished_at":null,"created_at":"2026-02-28T12:34:15.854805Z","beverage":{"name":"Incident Beer Zero Balance 94306","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"fc7b76da-78ee-456c-85f1-ea7cae158d6e"}}}},{"pour_id":"7a8a9e98-d86a-4c63-8c2a-a0f68411002f","volume_ml":0,"amount_charged":"0.00","duration_ms":null,"sync_status":"pending_sync","short_id":null,"is_manual_reconcile":false,"poured_at":"2026-02-28T12:32:31.823421Z","authorized_at":"2026-02-28T12:32:31.823421Z","synced_at":null,"reconciled_at":null,"ended_at":null,"started_at":null,"guest":{"guest_id":"8bb41ecc-b4ae-46d4-b411-2f2e25e322c1","last_name":"Zero","first_name":"Balance"},"beverage":{"name":"Incident Beer Zero Balance","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"52c1ab5c-f85e-4ee7-9008-9cb2093b93b5"},"tap":{"display_name":"Incident Tap Zero Balance","tap_id":1,"status":"processing_sync","keg_id":"bc02770b-a20a-47b1-a826-f15c55dc24a1","keg":{"initial_volume_ml":30000,"purchase_price":"1000.00","keg_id":"bc02770b-a20a-47b1-a826-f15c55dc24a1","beverage_id":"52c1ab5c-f85e-4ee7-9008-9cb2093b93b5","current_volume_ml":30000,"status":"in_use","tapped_at":"2026-02-28T12:32:31.723768Z","finished_at":null,"created_at":"2026-02-28T12:32:31.618325Z","beverage":{"name":"Incident Beer Zero Balance","brewery":null,"style":null,"abv":null,"sell_price_per_liter":"500.00","beverage_id":"52c1ab5c-f85e-4ee7-9008-9cb2093b93b5"}}}}]

>>> Get http://localhost:8000/api/visits/active/by-card/INCIDENT-ZERO-BALANCE-CARD-94306
Headers: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTc3MjI4Mzg1NX0.0mFFBTejbx1t9VPIGasyFRrCR7tkTN4gbJNb__cVcBw
<<< HTTP 200
{"visit_id":"a330ef27-cba4-4134-a4d6-9c19cab24522","guest_id":"2ab42e09-896b-47a3-a1cd-a549b5ac5def","card_uid":"INCIDENT-ZERO-BALANCE-CARD-94306","status":"active","opened_at":"2026-02-28T12:34:15.754817Z","closed_at":null,"closed_reason":null,"active_tap_id":2,"lock_set_at":"2026-02-28T12:34:16.020990Z","card_returned":true}

SUMMARY: suffix=94306 guest_id=2ab42e09-896b-47a3-a1cd-a549b5ac5def visit_id=a330ef27-cba4-4134-a4d6-9c19cab24522 tap_id=2 keg_id=58c1601f-13c8-4a48-b309-d8628bf3dbf5 card_uid=INCIDENT-ZERO-BALANCE-CARD-94306
