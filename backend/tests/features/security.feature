# language: ru
@security
Функционал: Аутентификация и Авторизация

  @TC-API-SEC-01
  Сценарий: Успешное получение JWT токена с валидными данными
    Дано Система готова к аутентификации
    Когда Клиент отправляет POST-запрос на /api/token с валидными username="admin" и password="fake_password"
    Тогда API должен вернуть ответ с кодом 200
    И Тело ответа должно содержать "access_token" и "token_type"

  @TC-API-SEC-02
  Сценарий: Попытка получения токена с неверным паролем
    Дано Система готова к аутентификации
    Когда Клиент отправляет POST-запрос на /api/token с валидными username="admin" и password="wrong_password"
    Тогда API должен вернуть ответ с кодом 400
    И Тело ответа должно содержать ошибку "Incorrect username or password"

  @TC-API-SEC-03
  Сценарий: Попытка получения токена с неверным именем пользователя
    Дано Система готова к аутентификации
    Когда Клиент отправляет POST-запрос на /api/token с валидными username="invalid_user" и password="fake_password"
    Тогда API должен вернуть ответ с кодом 400

  @TC-API-SEC-04
  Сценарий: Попытка получения токена без поля password
    Дано Система готова к аутентификации
    Когда Клиент отправляет POST-запрос на /api/token без поля "password"
    Тогда API должен вернуть ответ с кодом 422

  @TC-API-SEC-05
  Сценарий: Попытка получения токена с неверным Content-Type
    Дано Система готова к аутентификации
    Когда Клиент отправляет POST-запрос на /api/token с JSON-телом
    Тогда API должен вернуть ответ с кодом 422

  @TC-API-SEC-06
  Сценарий: Успешный доступ к защищенному ресурсу с валидным токеном
    Дано Администратор авторизован
    Когда Клиент отправляет GET-запрос на /api/guests/ с валидным токеном
    Тогда API должен вернуть ответ с кодом 200

  @TC-API-SEC-07
  Сценарий: Попытка доступа к защищенному ресурсу без токена
    Когда Клиент отправляет GET-запрос на /api/guests/ без токена
    Тогда API должен вернуть ответ с кодом 401

  @TC-API-SEC-08
  Сценарий: Попытка доступа к защищенному ресурсу с невалидным токеном
    Когда Клиент отправляет GET-запрос на /api/guests/ с искаженным токеном
    Тогда API должен вернуть ответ с кодом 401

  @TC-API-SEC-09
  Сценарий: Попытка доступа с токеном, подписанным неверным ключом
    Когда Клиент отправляет GET-запрос на /api/guests/ с токеном, подписанным другим ключом
    Тогда API должен вернуть ответ с кодом 401

@skip @TC-API-SEC-10
  Сценарий: Успешное создание записи в журнале аудита
    Дано Администратор авторизован
    Когда Клиент отправляет POST-запрос на /api/guests/ с валидными данными
    Тогда API должен вернуть ответ с кодом 201
    И В таблице "audit_logs" должна быть создана новая запись

  @TC-API-SEC-11
  Сценарий: Аудит НЕ срабатывает для GET-запросов
    Дано Администратор авторизован
    Когда Клиент отправляет GET-запрос на /api/guests/ с валидным токеном
    Тогда В таблице "audit_logs" НЕ должно быть создано новых записей

@skip @TC-API-SEC-12
  Сценарий: Аудит НЕ срабатывает при неавторизованном запросе
    Дано Клиент неавторизован
    Когда Клиент отправляет POST-запрос на /api/guests/ без токена
    Тогда API должен вернуть ответ с кодом 401
    И В таблице "audit_logs" НЕ должно быть создано новых записей